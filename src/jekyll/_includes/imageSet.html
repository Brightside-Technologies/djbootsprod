{% capture basename %} {{include.basename}} {% endcapture %}
{% assign stripBasename = {{basename | strip}} %}
{% assign responsive_images = site.static_files | where: "responsive", true %}
{% assign imageSetUrls = "" | split: ',' %}
{% assign imageSetItem = "" %}
{% assign default = "" %}
{% capture imgSet %}
    {% for img in responsive_images %}
        {% if img.path contains stripBasename %}

            {% if img.path contains '@1x' %}
                {% assign imageSetItem = {{img.path | prepend: 'url(' | append: ') 1x'}} %} 
            {% elsif img.path contains '@2x' %}
                {% assign imageSetItem = {{img.path | prepend: 'url(' | append: ') 2x'}} %}
                {% assign default = {{imageSetItem | replace: " 2x", ""}} %}
            {% elsif img.path contains '@3x' %}
                {% assign imageSetItem = {{img.path | prepend: 'url(' | append: ') 3x'}} %}
            {% else %}
                {% assign imageSetItem = {{img.path | prepend: 'url(' | append: ') 2x'}} %}
            {% endif %}

            {% assign imageSetUrls = imageSetUrls | push: imageSetItem %}

        {% endif %}
    {% endfor %}
    {{imageSetUrls | join: ', '}}
{% endcapture %}

<div class="{{include.class}}" style="background-image: {{default}}; background-image: image-set({{imgSet | strip}});"></div>